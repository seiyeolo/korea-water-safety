# Session Context - 2025-10-14

## ë¬¸ì œ ë¶„ì„

### ì´ˆê¸° ë³´ê³ 
ì‚¬ìš©ìê°€ êµìœ¡ í”„ë¡œê·¸ë¨ í˜ì´ì§€ì—ì„œ "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (Network Error)" ë¬¸ì œ ë³´ê³ 

### ë¬¸ì œ ì§„ë‹¨ ê³¼ì •

1. **í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ í™•ì¸** âœ…
   - [programs/page.tsx](../frontend/src/app/programs/page.tsx): API ì—°ë™ ë¡œì§ ì •ìƒ
   - [usePrograms hook](../frontend/src/hooks/usePrograms.ts): getPrograms API í˜¸ì¶œ
   - [api.ts](../frontend/src/lib/api.ts): Railway API ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©

2. **ë°±ì—”ë“œ API í…ŒìŠ¤íŠ¸** âŒ
   ```bash
   curl https://strong-wholeness-production.up.railway.app/api/programs
   # ê²°ê³¼: {"statusCode": 500, "message": "Internal server error"}
   ```

3. **ë¡œì»¬ ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸** âœ…
   - ë¡œì»¬ ì‹¤í–‰: ì •ìƒ ì‘ë™, 10ê°œ í”„ë¡œê·¸ë¨ ë°ì´í„° ë°˜í™˜
   - [programs.service.ts](../backend/src/modules/programs/programs.service.ts): ë¡œì§ ì •ìƒ
   - [seed.ts](../backend/prisma/seed.ts): Seed ë°ì´í„° í™•ì¸

4. **Railway ë°°í¬ ë¡œê·¸ í™•ì¸** ğŸ”
   - **ì—ëŸ¬**: `P1001: Can't reach database server at postgres.railway.internal:5432`
   - **ì›ì¸**: ë¹Œë“œ ë‹¨ê³„ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹œë„

## í•´ê²° ê³¼ì •

### ì‹œë„ 1: Railway ì„¤ì • íŒŒì¼ ì¶”ê°€ âŒ
- `railway.json` ìƒì„±: ë¹Œë“œ ëª…ë ¹ì— migrate/seed í¬í•¨
- `nixpacks.toml` ìƒì„±: ë™ì¼í•œ ì ‘ê·¼
- **ë¬¸ì œ**: Railway ë¹Œë“œ ë‹¨ê³„ì—ì„œëŠ” DB ì ‘ê·¼ ë¶ˆê°€

### ì‹œë„ 2: Start ë‹¨ê³„ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ë™ âŒ
- ë¹Œë“œ: `npm run build` + `prisma generate`
- Start: `prisma migrate deploy && seed:prod && npm start`
- **ë¬¸ì œ**: 502 ì—ëŸ¬, ì„œë²„ ì‹œì‘ íƒ€ì„ì•„ì›ƒ

### ì‹œë„ 3: Start ìŠ¤í¬ë¦½íŠ¸ ë¶„ë¦¬ âœ… (ìµœì¢… í•´ê²°)
- [scripts/start.sh](../backend/scripts/start.sh) ìƒì„±
- ìˆœì°¨ì  ì‹¤í–‰: migrate â†’ seed (ì—ëŸ¬ í—ˆìš©) â†’ server start
- `exec npm start`ë¡œ ì•ˆì •ì ì¸ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬

## ì ìš©ëœ ë³€ê²½ì‚¬í•­

### 1. [backend/scripts/start.sh](../backend/scripts/start.sh) - NEW
```bash
#!/bin/bash
set -e

echo "ğŸš€ Starting deployment process..."
npx prisma migrate deploy
npm run seed:prod || echo "âš ï¸ Seed skipped"
exec npm start
```

### 2. [backend/nixpacks.toml](../backend/nixpacks.toml) - MODIFIED
```toml
[phases.build]
cmds = ["npm run build", "npx prisma generate"]

[start]
cmd = "./scripts/start.sh"
```

### 3. [backend/railway.json](../backend/railway.json) - MODIFIED
```json
{
  "deploy": {
    "startCommand": "./scripts/start.sh"
  }
}
```

### 4. [backend/package.json](../backend/package.json) - MODIFIED
- `build`: `tsc && prisma generate`
- `postinstall`: `prisma generate`
- `seed:prod`: `node dist/prisma/seed.js`

### 5. [backend/prisma/seed.ts](../backend/prisma/seed.ts) - MODIFIED
- ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€: ë°ì´í„°ê°€ ìˆìœ¼ë©´ ìŠ¤í‚µ
- í™˜ê²½ êµ¬ë¶„ ì œê±°: ëª¨ë“  í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê²Œ ì‹¤í–‰

### 6. [backend/src/main.ts](../backend/src/main.ts) - MODIFIED
- CORS ì„¤ì • ê°œì„ : ì •ê·œì‹ íŒ¨í„´ ì§€ì›
- Vercel ì™€ì¼ë“œì¹´ë“œ ë„ë©”ì¸ ì§€ì›

## Git ì»¤ë°‹ íˆìŠ¤í† ë¦¬

```
afcd2c9 feat: Railway ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ ê°œì„ 
32d0f22 fix: Railway ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ ìˆ˜ì • - DB ì—°ê²° íƒ€ì´ë° í•´ê²°
8053ec7 feat: Railway Nixpacks ì„¤ì • ì¶”ê°€
7620816 fix: Railway ë°°í¬ ì‹œ ìë™ seed ì‹¤í–‰ ë° CORS ê°œì„ 
```

## ë‹¤ìŒ ë‹¨ê³„

1. â³ Railway ë°°í¬ ì™„ë£Œ ëŒ€ê¸° (2-3ë¶„)
2. ğŸ§ª API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
3. âœ… í”„ë¡ íŠ¸ì—”ë“œì—ì„œ êµìœ¡ í”„ë¡œê·¸ë¨ í˜ì´ì§€ í™•ì¸
4. ğŸ“ ì„¸ì…˜ ë¬¸ì„œ ì—…ë°ì´íŠ¸

## ê¸°ìˆ ì  í•™ìŠµ í¬ì¸íŠ¸

### Railway ë°°í¬ ì œì•½ì‚¬í•­
- **ë¹Œë“œ ë‹¨ê³„**: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¶ˆê°€
- **ì‹œì‘ ë‹¨ê³„**: ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ê°€ëŠ¥
- **í•´ê²°ì±…**: DB ì‘ì—…ì„ start ìŠ¤í¬ë¦½íŠ¸ë¡œ ì´ë™

### Prisma ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ
- **ê°œë°œ**: `prisma migrate dev`
- **í”„ë¡œë•ì…˜**: `prisma migrate deploy`
- **Seed**: ë©±ë“±ì„± í™•ë³´ (ì¤‘ë³µ ì‹¤í–‰ ì•ˆì „)

### NestJS + Prisma + Railway ë°°í¬ íŒ¨í„´
```
ë¹Œë“œ: TypeScript ì»´íŒŒì¼ + Prisma Client ìƒì„±
ì‹œì‘: DB ë§ˆì´ê·¸ë ˆì´ì…˜ â†’ Seed â†’ ì„œë²„ ì‹¤í–‰
```

## ì°¸ê³  ë§í¬
- Railway Docs: https://docs.railway.app
- Prisma Deploy: https://www.prisma.io/docs/guides/migrate/production
- NestJS Deployment: https://docs.nestjs.com/deployment
